{% include "header.html" %}
{% extends "base_test.html" %}
{% block content %}


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

  <a href="{{ url_for('limite_credito.formulario_cadastrar_emissor') }}" class="btn btn-primary mb-5">
    Cadastrar Novo Emissor
  </a>

  <section class="section">
    <div class="row">
      <div class="col-lg-12">

        <div class="card">
          <div class="card-body">
            <h5 class="card-title"> Emissores </h5>
            <!-- Table with stripped rows -->
            <table class="table datatable" id="table_datatable">
              <thead>
                <tr>
                    <th>CNPJ</th>
                    <th>Instituição de Garantia (CNPJ)</th>
                    <th>Rating</th>
                    <th>Emissor</th>
                    <th>Analista</th>
                    <th>Setor</th>
                    <th>Grupo</th>
                    <th>Mesa de Gestão</th>
                    <th>Data de Atualização</th>
                    <th>Ações</th>
                </tr>
              </thead>
              <tbody>
                {% for emissor in emissores %}
                <tr>
                    <td>{{ emissor.cnpj }}</td>
                    <td>{{ emissor.instituicao_garantia_cnpj }}</td>
                    <td>{{ emissor.rating }}</td>
                    <td>{{ emissor.emissor }}</td>
                    <td>{{ emissor.analista }}</td>
                    <td>{{ emissor.setor }}</td>
                    <td>{{ emissor.grupo }}</td>
                    <td>{{ emissor.mesa_gestao }}</td>
                    <td>{{ emissor.data_atualizacao.strftime('%d/%m/%Y %H:%M') }}</td>
                    <td>
                        <a href="{{ url_for('limite_credito.editar_emissor', cnpj=emissor.cnpj) }}" class="btn btn-warning btn-sm">Editar</a>
                        <form action="{{ url_for('limite_credito.excluir_emissor', cnpj=emissor.cnpj) }}" method="POST" style="display:inline;">
                            <button type="submit" class="btn btn-danger btn-sm">Excluir</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
            <!-- End Table with stripped rows -->

          </div>
        </div>

      </div>
    </div>
  </section>

<!-- Toasts -->
<div aria-live="polite" aria-atomic="true" style="position: relative;">
    <div class="toast-container" style="position: absolute; top: 20px; right: 20px;">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-autohide="true" style="margin-bottom: 1rem;">
                        <div class="toast-header">
                            <strong class="mr-auto">{{ category.capitalize() }}</strong>
                            <small class="text-muted">Agora</small>
                            <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="toast-body">
                            {{ message }}
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>
</div>

<script>
   $(document).ready(function() {
       $('#table_datatable').DataTable();
   });
</script>

 <script>
    $(document).ready(function () {
        $('.toast').toast('show');
    });
</script>
{% endblock %}